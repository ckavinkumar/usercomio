function trackEvent(){window.usercomlib.trackEvent=function(e,n){var t=this;if(!e||0==e.length)return void console.error("Usercom Error: Event name not provided !");var r={appid:t.appid,userdata:t.userData,properties:n,eventname:e,sessionId:t.sessionId,visitorId:t.visitorId};xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/event",JSON.stringify(r),function(e){console.log(e)})}}function createServiceWorker(){navigator.serviceWorker.register(DEFAULT_CONFIG.serviceWorkerFile).then(function(e){return e.pushManager.getSubscription().then(function(n){return n||e.pushManager.subscribe({userVisibleOnly:!0})})}).then(function(e){fetch(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/register",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({sessionId:usercomlib.sessionId,endpoint:e.endpoint,p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("p256dh")))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey("auth"))))})})})}var HTTP_PROTOCOL="https:"===document.location.protocol?"https://":"http://",utils={guidGenerator:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},extendObj:function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}},cookie={createCookie:function(e,n,t){var r="";if(t){var o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3),r="; expires="+o.toUTCString()}document.cookie=e+"="+n+r+"; path=/"},readCookie:function(e){for(var n=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){for(var o=t[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(n))return o.substring(n.length,o.length)}return null},eraseCookie:function(e){createCookie(e,"",-1)}},xhr={formdata:function(e,n,t){try{var r=new XMLHttpRequest;r.open(n?"POST":"GET",e,1),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){r.readyState>3&&callback&&callback(r.responseText,r)},r.send(n)}catch(e){window.console&&console.log(e)}},raw:function(e,n,t){try{var r=new XMLHttpRequest;r.open(n?"POST":"GET",e,1),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/json"),r.onreadystatechange=function(){r.readyState>3&&t&&t(r.responseText,r)},r.send(n)}catch(e){window.console&&console.log(e)}}},DEFAULT_CONFIG={api_host:"http://localhost:3000",serviceWorkerFile:"/usercom-sw.js"},SERVICES=["trackEvent"],Usercom={props:{sessionId:null,visitorId:null,appid:null},init:function(e){var n="d109bb0e26c14b68ccf2face7822f0dc",t=this;if(0==n.length)return void console.error("Usercom Error: Invalid app id !");window.usercomlib={},usercomlib.appid=n,usercomlib.userdata=e,t.establishSocketConnection(usercomlib),t.bindGlobalErrorHandler(usercomlib),t.props.appid=n;var r={appid:n,userdata:e,uid:utils.guidGenerator(),screenResolution:screen.width+"x"+screen.height,timezone:-(new Date).getTimezoneOffset()/60};xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/ping",JSON.stringify(r),function(e){console.log(e);var n=JSON.parse(e);t.props.sessionId=n.sessionId,t.props.visitorId=n.status._id,usercomlib.sessionId=n.sessionId,usercomlib.visitorId=n.status._id,t.initServices()})},establishSocketConnection:function(e){var n=new WebSocket("ws://localhost:8001/");n.onopen=function(){var t={};t.name="establishvisitorconnection",t.key=e.userdata.email+"-"+e.appid,t=JSON.stringify(t),n.send(t)},n.onclose=function(){n.send("closing")}},bindGlobalErrorHandler:function(e){var n=window.onerror;window.onerror=function(t,r,o,i,s){n&&n.apply(this,arguments);var a=["Message: "+t,"URL: "+r,"Line: "+o,"Column: "+i,"Error object: "+JSON.stringify(s)].join(" - "),c={appid:e.appid,userdata:e.userData,errormsg:a,uid:utils.guidGenerator()};return xhr.raw(DEFAULT_CONFIG.api_host+"/VisitorTrackingManager/error",JSON.stringify(c),function(e){console.log(e)}),!1}},initServices:function(){for(var e=0;e<SERVICES.length;e++)try{window[SERVICES[e]]()}catch(n){console.log(SERVICES[e]+" service is not present  !")}}};SERVICES.push('trackElement,')