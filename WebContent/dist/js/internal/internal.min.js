function UC_LoginController(){var a=this;this.constructor=function(){this.bindUIEvents()},this.bindUIEvents=function(){$("#uclogin_submitbtn").on("click",a.handleLoginBtnAction),$("#uclogin_forgotpasswordbtn").on("click",a.handleForgotPasswordBtnAction)},this.handleLoginBtnAction=function(){var b=$("#uclogin_usernameinput").val(),c=$("#uclogin_passwordinput").val(),d={username:b,password:c};a.sendLoginRequest(d)},this.sendLoginRequest=function(a){if(!a.username||!a.password)throw"username or password  was not provided.";UC_AJAX.call("LoginManager/validateUser",{username:a.username,password:a.password},function(a,b,c){a&&(a.error?alert(a.error):location.href="/")})},this.handleForgotPasswordBtnAction=function(){var a=$("#uclogin_usernameinput").val(),b=UC_Utils.guidGenerator();if(0==$.trim(a).length)return void alert("Email is required !");UC_AJAX.call("LoginManager/forgotPassword",{email:a,token:b},function(a,b,c){if(a){if("success"==a.status)return void alert("Check E-mail for resetting Password.  (If not received check Spam folder) ");if("failure"==a.status)return void alert("An error accured !")}})}}function UC_UserController(){var a=this;this.config={},this.constructor=function(){$(document).on("click",".ucEditProfile",a.editProfileHandler),$(document).on("click",".ucChangePassword",a.editPasswordHandler),$(document).on("click",".ucEditMail",a.editMailHandler),$(document).on("click",".ucEditDatabase",a.editDatabaseHandler),$(document).on("click",".ucEditSystem",a.editSystemHandler),$(document).on("click","#uceditprofile_submit",a.handleProfileSaveAction),$(document).on("click","#ucchangepassword_submit",a.handlePasswordSaveAction),$(document).on("click","#uceditmail_submit",a.handleMailSaveAction),$(document).on("click","#uceditdatabase_submit",a.handleDatabaseSaveAction),$(document).on("click","#uceditsystem_submit",a.handleSystemSaveAction),$(document).on("click","#ucEditEmailTypeTabGroup button",a.handleTypeSelectionAction)},this.editProfileHandler=function(a){var b=UC_UserSession.user;$("#uceditprofile_firstname").val(b.firstName),$("#uceditprofile_lastname").val(b.lastName),$("#ucEditProfileModal").modal(),$("#ucEditProfileAjaxLoader").hide(),a.preventDefault()},this.handleProfileSaveAction=function(){var b=$("#uceditprofile_firstname").val(),c=$("#uceditprofile_lastname").val(),d=a.validateProfileInputs();if("failure"==d.status)return void alert(d.msg);var e=UC_UserSession.user;e.firstName=b,e.lastName=c,UC_UserSession.user=e,$("#ucEditProfileAjaxLoader").show(),UC_AJAX.call("UserManager/saveUserProfile",{user:e},function(a,b,c){a&&("failure"==a.status?alert("An Error accured while saving data !"):(alert("Profile saved successfully"),uc_main.rivetUserNameObj.models.currentUserName=e.firstName+" "+e.lastName,$("#ucEditProfileModal").modal("hide"))),$("#ucEditProfileAjaxLoader").hide()})},this.validateProfileInputs=function(){var a={status:"success",msg:""},b=$("#uceditprofile_firstname").val(),c=$("#uceditprofile_lastname").val(),d="";return""==$.trim(b)?d="Invalid First Name !":""==$.trim(c)&&(d="Invalid Last Name !"),""!=d&&(a.status="failure",a.msg=d),a},this.editPasswordHandler=function(a){$("#ucEditPasswordModal").modal(),$("#ucEditPasswordAjaxLoader").hide(),a.preventDefault()},this.handlePasswordSaveAction=function(){var b=$("#ucchangepassword_password").val(),c=($("#ucchangepassword_confirmpassword").val(),a.validatePasswordInputs());if("failure"==c.status)return void alert(c.msg);var d=UC_UserSession.user;d.password=b,UC_UserSession.user=d,$("#ucEditPasswordAjaxLoader").show(),UC_AJAX.call("UserManager/saveUserPassword",{user:d},function(a,b,c){a&&(delete UC_UserSession.user.password,"failure"==a.status?alert("An Error accured while saving data !"):(alert("Password changed successfully"),$("#ucEditPasswordModal").modal("hide")),$("#ucEditPasswordAjaxLoader").hide())})},this.validatePasswordInputs=function(){var a={status:"success",msg:""},b=$("#ucchangepassword_password").val(),c=$("#ucchangepassword_confirmpassword").val(),d="";return""==$.trim(b)?d="Invalid Password !":$.trim(b)!=$.trim(c)&&(d="Confirm Password should match the New Password field"),""!=d&&(a.status="failure",a.msg=d),a},this.editMailHandler=function(b){a.config.emailType?a.currentEmailType=a.config.emailType:a.currentEmailType="SMTP",$(".ucEditEmailContainer").hide(),$("#ucEditEmail"+a.currentEmailType+"Container").show(),$("#ucEditEmailTypeTabGroup button").removeClass("active"),$("#ucEditEmailTypeTabGroup button[data-tabgroup-tabid=ucEditEmail"+a.currentEmailType+"Container]").addClass("active"),a.config.smtp&&($("#uceditsmtp_host").val(a.config.smtp.host),$("#uceditsmtp_port").val(a.config.smtp.port),$("#uceditsmtp_user").val(a.config.smtp.user),$("#uceditsmtp_pass").val(a.config.smtp.pass)),a.config.mailgun&&($("#uceditmailgun_key").val(a.config.mailgun.key),$("#uceditmailgun_domain").val(a.config.mailgun.domain),$("#uceditmailgun_from").val(a.config.mailgun.from)),a.config.amazon&&($("#uceditamazon_key").val(a.config.amazon.key),$("#uceditamazon_secret").val(a.config.amazon.secret),$("#uceditamazon_region").val(a.config.amazon.region),$("#uceditamazon_from").val(a.config.amazon.from)),$("#ucEditMailModal").modal(),$("#ucEditEmailAjaxLoader").hide(),b.preventDefault()},this.handleMailSaveAction=function(){if("SMTP"==a.currentEmailType){var b=$("#uceditsmtp_host").val(),c=$("#uceditsmtp_port").val(),d=$("#uceditsmtp_user").val(),e=$("#uceditsmtp_pass").val(),f=a.validateSMTPInputs();if("failure"==f.status)return void alert(f.msg);a.config.emailType="SMTP",a.config.smtp.host=b,a.config.smtp.port=c,a.config.smtp.user=d,a.config.smtp.pass=e}else if("Mailgun"==a.currentEmailType){var g=$("#uceditmailgun_key").val(),h=$("#uceditmailgun_domain").val(),i=$("#uceditmailgun_from").val(),f=a.validateMailgunInputs();if("failure"==f.status)return void alert(f.msg);a.config.emailType="Mailgun",a.config.mailgun={},a.config.mailgun.key=g,a.config.mailgun.domain=h,a.config.mailgun.from=i}else if("Amazon"==a.currentEmailType){var j=$("#uceditamazon_key").val(),k=$("#uceditamazon_secret").val(),l=$("#uceditamazon_region").val(),m=$("#uceditamazon_from").val(),f=a.validateAmazonInputs();if("failure"==f.status)return void alert(f.msg);a.config.emailType="Amazon",a.config.amazon={},a.config.amazon.key=j,a.config.amazon.secret=k,a.config.amazon.region=l,a.config.amazon.from=m}$("#ucEditEmailAjaxLoader").show(),UC_AJAX.call("UserManager/saveconfig",{config:a.config},function(a,b,c){a&&("failure"==a.status?alert("An Error accured while saving config file!"):(alert("Email settings changed successfully"),$("#ucEditMailModal").modal("hide")),$("#ucEditEmailAjaxLoader").hide())})},this.validateSMTPInputs=function(){var a={status:"success",msg:""},b=$("#uceditsmtp_host").val(),c=$("#uceditsmtp_port").val(),d="";return""==$.trim(b)?d="Invalid Host Name !":""==$.trim(c)&&(d="Invalid Port !"),""!=d&&(a.status="failure",a.msg=d),a},this.validateMailgunInputs=function(){var a={status:"success",msg:""},b=$("#uceditmailgun_key").val(),c=$("#uceditmailgun_domain").val(),d=$("#uceditmailgun_from").val(),e="";return""==$.trim(b)?e="Invalid Key":""==$.trim(c)?e="Invalid Domain":""==$.trim(d)&&(e="Invalid From email"),""!=e&&(a.status="failure",a.msg=e),a},this.validateAmazonInputs=function(){var a={status:"success",msg:""},b=$("#uceditamazon_key").val(),c=$("#uceditamazon_secret").val(),d=$("#uceditamazon_region").val(),e=$("#uceditamazon_from").val(),f="";return""==$.trim(b)?f="Invalid Key !":""==$.trim(c)?f="Invalid Secret !":""==$.trim(d)?f="Invalid Region !":""==$.trim(e)&&(f="Invalid From Email !"),""!=f&&(a.status="failure",a.msg=f),a},this.editDatabaseHandler=function(b){$("#uceditdatabase_host").val(a.config.database.host),$("#uceditdatabase_port").val(a.config.database.port),$("#uceditdatabase_user").val(a.config.database.user),$("#ucEditDatabaseModal").modal(),$("#ucEditDatabaseAjaxLoader").hide(),b.preventDefault()},this.handleDatabaseSaveAction=function(){var b=$("#uceditdatabase_host").val(),c=$("#uceditdatabase_port").val(),d=$("#uceditdatabase_user").val(),e=$("#uceditdatabase_pass").val(),f=a.validateDatabaseInputs();if("failure"==f.status)return void alert(f.msg);a.config.database.host=b,a.config.database.port=c,a.config.database.user=d,a.config.database.pass=e,$("#ucEditDatabaseAjaxLoader").show(),UC_AJAX.call("UserManager/verifydbconnection",{dbhost:b,dbport:c,dbuser:d,dbpass:e,dbname:a.config.database.name},function(b,c,d){b&&("connected"==b.status?UC_AJAX.call("UserManager/saveconfig",{config:a.config},function(a,b,c){a&&("failure"==a.status?alert("An Error accured while saving config file!"):(alert("Database settings changed successfully"),$("#ucEditDatabaseModal").modal("hide")),$("#ucEditDatabaseAjaxLoader").hide())}):"failure"==b.status?(alert("Database connection cannot be established with the provided details"),$("#ucEditDatabaseAjaxLoader").hide()):(alert("An Error accured while saving data. Try again!"),$("#ucEditDatabaseAjaxLoader").hide()))})},this.validateDatabaseInputs=function(){var a={status:"success",msg:""},b=$("#uceditdatabase_host").val(),c=$("#uceditdatabase_port").val(),d="";return""==$.trim(b)?d="Invalid Host Name !":""==$.trim(c)&&(d="Invalid Port !"),""!=d&&(a.status="failure",a.msg=d),a},this.editSystemHandler=function(b){$("#uceditsystem_baseurl").val(a.config.baseURL),$("#ucEditSystemModal").modal(),$("#ucEditSystemAjaxLoader").hide(),b.preventDefault()},this.handleSystemSaveAction=function(){var b=$("#uceditsystem_baseurl").val(),c=a.validateSystemInputs();if("failure"==c.status)return void alert(c.msg);a.config.baseURL=b,$("#ucEditSystemAjaxLoader").show(),UC_AJAX.call("UserManager/saveconfig",{config:a.config},function(a,b,c){a&&("failure"==a.status?alert("An Error accured while saving config file!"):(alert("System settings changed successfully"),$("#ucEditSystemModal").modal("hide")),$("#ucEditSystemAjaxLoader").hide())})},this.validateSystemInputs=function(){var a={status:"success",msg:""},b=$("#uceditsystem_baseurl").val(),c="";return""==$.trim(b)&&(c="Invalid Host Name !"),""!=c&&(a.status="failure",a.msg=c),a},this.handleTypeSelectionAction=function(){a.currentEmailType=$(this).attr("data-emailType")}}function UC_UserRegistrationController(){var a=this;this.config={},this.constructor=function(){this.bindUIEvents(),$("#UC_Setup_Welcome_Page").show()},this.bindUIEvents=function(){$("#ucsetup_getting_startedbtn").on("click",a.handleGettingStartedBtnAction),$("#ucuserreg_submitbtn").on("click",a.handleRegisterBtnAction),$("#ucsetup_dbsubmitbtn").on("click",a.handleSetupDBAction),$("#ucsetup_smtpsubmitbtn").on("click",a.handleSetupSMTPAction),$("#ucsetup_usersubmitbtn").on("click",a.handleSetupUserAction),$("#ucsetup_appsubmitbtn").on("click",a.handleSetupAppAction)},this.handleGettingStartedBtnAction=function(){$(".UC_SetupContainerCls").hide(),$("#UC_Setup_Database").show(),$(".ucSetupProgressSteps li").removeClass("active"),$(".uc_database_details").addClass("active"),$("#ucSetupDatabaseAjaxLoader").hide()},this.handleRegisterBtnAction=function(){var b=$("#ucuserreg_emailinput").val(),c=$("#ucuserreg_passwordinput").val(),d=($("#ucuserreg_confirmpasswordinput").val(),$("#ucuserreg_fullnameinput").val()),e=a.validateUserRegistrationInputs();if("failure"==e.status)return void alert(e.msg);var f=new UC_User;f._id=b,f.username=b,f.firstName=d,f.password=c,f.company="C"+UC_Utils.guidGenerator(),a.sendLoginRequest(f,!0)},this.validateUserRegistrationInputs=function(){var a={status:"success",msg:""},b=$("#ucuserreg_emailinput").val(),c=$("#ucuserreg_passwordinput").val(),d=$("#ucuserreg_confirmpasswordinput").val(),e=$("#ucuserreg_fullnameinput").val(),f="";return""==$.trim(e)?f="Invalid Name !":""!=$.trim(b)&&UC_Utils.isValidEmail(b)?""==$.trim(c)?f="Invalid Password !":c!=d&&(f="Password & Confirm Password doesn't match !"):f="Invalid Email !",""!=f&&(a.status="failure",a.msg=f),a},this.sendLoginRequest=function(a,b){b||$("#ucSetupUserAjaxLoader").show(),UC_AJAX.call("UserManager/registerUser",{user:a},function(c,d,e){c&&("userexists"==c.status?alert("Username already exists !"):"failure"==c.status?alert("An Error accured while saving data !"):b?location.href="/login":(UC_UserSession.user=a,$(".UC_SetupContainerCls").hide(),$("#UC_Setup_App").show(),$(".ucSetupProgressSteps li").removeClass("active"),$(".uc_user_settings").addClass("active"),$("#UC_Setup_Progress_Step").text("4"),$("#ucSetupUserAjaxLoader").hide(),$("#ucSetupAppAjaxLoader").hide()))})},this.handleSetupDBAction=function(){var b=$("#ucsetup_dbhostinput").val(),c=$("#ucsetup_dbportinput").val(),d=$("#ucsetup_dbuserinput").val(),e=$("#ucsetup_dbpassinput").val(),f=$("#ucsetup_dbnameinput").val(),g=a.validateSetupDBInputs();if("failure"==g.status)return void alert(g.msg);$("#ucSetupDatabaseAjaxLoader").show(),UC_AJAX.call("UserManager/verifydbconnection",{dbhost:b,dbport:c,dbuser:d,dbpass:e,dbname:f},function(g,h,i){g&&("connected"==g.status?(a.config.database={},a.config.database.host=b,a.config.database.port=c,a.config.database.user=d,a.config.database.pass=e,a.config.database.name=f,a.saveConfig(!1),$(".UC_SetupContainerCls").hide(),$("#UC_Setup_SMTP").show(),$("#UC_Setup_Progress_Step").text("2"),$(".ucSetupProgressSteps li").removeClass("active"),$(".uc_smtp_details").addClass("active"),$("#ucSetupEmailAjaxLoader").hide()):"failure"==g.status?alert("Database connection cannot be established with the provided details"):alert("An Error accured while saving data. Try again!"),$("#ucSetupDatabaseAjaxLoader").hide())})},this.handleSetupSMTPAction=function(){var b=$("#ucsetup_smtphostinput").val(),c=$("#ucsetup_smtpportinput").val(),d=$("#ucsetup_smtpuserinput").val(),e=$("#ucsetup_smtppassinput").val();a.config.emailType="SMTP",a.config.smtp={},a.config.smtp.host=b,a.config.smtp.port=c,a.config.smtp.user=d,a.config.smtp.pass=e,$("#ucSetupEmailAjaxLoader").show(),a.saveConfig(!1),$(".UC_SetupContainerCls").hide(),$("#UC_Setup_User").show(),$("#UC_Setup_Progress_Step").text("3"),$(".ucSetupProgressSteps li").removeClass("active"),$(".uc_admin_details").addClass("active")},this.handleSetupUserAction=function(){var b=$("#ucsetup_emailinput").val(),c=$("#ucsetup_passwordinput").val(),d=($("#ucsetup_confirmpasswordinput").val(),$("#ucsetup_fullnameinput").val()),e=a.validateSetupUserInputs();if("failure"==e.status)return void alert(e.msg);var f=new UC_User;f._id=b,f.username=b,f.firstName=d,f.password=c,f.password=c,f.company="C"+UC_Utils.guidGenerator(),a.sendLoginRequest(f,!1)},this.handleSetupAppAction=function(){var b=$("#ucsetup_baseurlinput").val(),c=$("#ucsetup_appnameinput").val(),d=a.validateSetupAppInputs();if("failure"==d.status)return void alert(d.msg);a.config.baseURL=b,a.config.setupCompleted=1;var e=new UC_App,f=UC_UserSession.user;e.name=c,e.creator=f.username,e._id=UC_Utils.guidGenerator(),e.clientId=f.company,$("#ucSetupAppAjaxLoader").show(),UC_AJAX.call("AppManager/createNewApp",{newApp:e,user:f},function(b,c,d){"appexists"==b.status?alert("App with this name already exists !"):"failure"==b.status?alert("An Error accured while saving data !"):a.saveConfig(!0)})},this.validateSetupDBInputs=function(){var a={status:"success",msg:""},b=$("#ucsetup_dbhostinput").val(),c=$("#ucsetup_dbportinput").val(),d=($("#ucsetup_dbuserinput").val(),$("#ucsetup_dbpassinput").val(),$("#ucsetup_dbnameinput").val()),e="";return""==$.trim(b)?e="Invalid Database Host !":""==$.trim(c)?e="Invalid Database Port !":""==$.trim(d)&&(e="Invalid Database Name !"),""!=e&&(a.status="failure",a.msg=e),a},this.validateSetupUserInputs=function(){var a={status:"success",msg:""},b=$("#ucsetup_emailinput").val(),c=$("#ucsetup_passwordinput").val(),d=$("#ucsetup_confirmpasswordinput").val(),e=$("#ucsetup_fullnameinput").val(),f="";return""==$.trim(e)?f="Invalid Name !":""!=$.trim(b)&&UC_Utils.isValidEmail(b)?""==$.trim(c)?f="Invalid Password !":c!=d&&(f="Password & Confirm Password doesn't match !"):f="Invalid Email !",""!=f&&(a.status="failure",a.msg=f),a},this.validateSetupAppInputs=function(){var a={status:"success",msg:""},b=$("#ucsetup_baseurlinput").val(),c=$("#ucsetup_appnameinput").val(),d="";return""==$.trim(b)?d="Invalid Base URL !":""==$.trim(c)&&(d="Invalid App Name !"),""!=d&&(a.status="failure",a.msg=d),a},this.saveConfig=function(b){UC_AJAX.call("UserManager/saveconfig",{config:a.config},function(a,c,d){a&&("failure"==a.status?alert("An Error accured while saving config file!"):b&&setTimeout(function(){location.href="/"},2e3)),$("#ucSetupEmailAjaxLoader").hide(),$("#ucSetupUserAjaxLoader").hide()})}}function UC_AppController(){var a=this;this.apps=[],this.currentAppId=null,this.rivetAppNameObj=null,this.rivetAppListObj=null,this.renderVisitors=!1,this.constructor=function(){this.bindUIEvents(),a.initRivetBinds(),$(document).on("click","#uc_app_list li",function(){for(var b=$(this).attr("data-appid"),c=0;c<a.apps.length;c++)if(b==a.apps[c]._id){a.switchApp(a.apps[c]);break}})},this.initRivetBinds=function(){a.rivetAppNameObj=rivets.bind(document.querySelector("#uc_currentapp_name"),{currentAppName:a.currentAppId})},this.bindUIEvents=function(){$(document).on("click","#uc_create_newapp_modalopen_btn",function(){$("#uc_newapp_creation_modal").modal("show"),$("#ucNewAppAjaxLoader").hide()}),$("#uc_create_newapp_submitbtn").on("click",function(){a.createNewApp()}),$("#ucupdate_app_submitbtn").on("click",function(b){b.stopImmediatePropagation(),a.updateAppDetails()}),a.getAllUserApps()},this.getAllUserApps=function(){UC_AJAX.call("AppManager/getAllUserApps",{user:UC_UserSession.user},function(b,c,d){"failure"==b.status?alert("An Error accured while fetching user's app !"):b.status.length>0&&(a.apps=b.status,a.listApps(a.apps),a.switchApp(a.apps[0]))})},this.createNewApp=function(){var b=$("#uc_create_newapp_nameinput").val(),c=a.validateAppInputDetails();if(""==c){var d=new UC_App,e=UC_UserSession.user;d.name=b,d.creator=e.username,d._id=UC_Utils.guidGenerator(),d.clientId=e.company,$("#ucNewAppAjaxLoader").show(),UC_AJAX.call("AppManager/createNewApp",{newApp:d,user:e},function(b,c,d){"appexists"==b.status?alert("App with this name already exists !"):"failure"==b.status?alert("An Error accured while saving data !"):(a.apps.push(b.status),a.listApps(a.apps),$("#uc_newapp_creation_modal").modal("hide"),a.switchApp(a.apps[0])),$("#ucNewAppAjaxLoader").hide()})}else alert(c)},this.listApps=function(b){var c={appList:b};null==a.rivetAppListObj?a.rivetAppListObj=rivets.bind(document.querySelector("#uc_app_list"),{list:c}):a.rivetAppListObj.models.list=c,a.bindAppDetailModificationOperationEvents()},this.bindAppDetailModificationOperationEvents=function(){$(".ucapp_editbtncls").on("click",function(b){b.stopImmediatePropagation(),$("#ucapp_update_modal").modal("show");var c=$(this).attr("data-appid");a.fillAppInformationInUpdateModal(c),$("#ucUpdateAppAjaxLoader").hide()}),$(".ucapp_deletebtncls").on("click",function(b){b.stopImmediatePropagation();var c=$(this).attr("data-appid");a.deleteAnApp(c)})},this.updateAppDetails=function(){var b=$("#ucapp_update_appid").val(),c=$("#ucapp_update_nameinput").val(),d=UC_Utils.searchObjArray(a.apps,"_id",b);if(-1!=d){var e=a.apps[d];e.name=c,$("#ucUpdateAppAjaxLoader").show(),UC_AJAX.call("AppManager/updateAnAppDetails",{app:e},function(b,c,d){"appexists"==b.status?alert("App with this name already exists !"):"failure"==b.status?alert("An Error accured while saving data !"):(a.updateAppDetailsInAppsListing(e),a.currentAppId==e._id&&(a.rivetAppNameObj.models.currentAppName=e.name),$("#ucapp_update_modal").modal("hide")),$("#ucUpdateAppAjaxLoader").hide()})}},this.deleteAnApp=function(b){var c=UC_Utils.searchObjArray(a.apps,"id",b),d=a.apps[c];confirm("Do you want to delete "+d.name+" ?")&&d&&UC_AJAX.call("AppManager/deleteAnApp",{app:d},function(b,e,f){"failure"==b.status?alert("An Error accured while deleting the app entry !"):(a.apps.splice(c,1),a.deleteAnAppEntryFromListing(d._id))})},this.deleteAnAppEntryFromListing=function(a){a&&$("#app_"+a).remove()},this.updateAppDetailsInAppsListing=function(a){a&&$("#app_"+a._id).find(".ucapp_namecls").html(a.name)},this.fillAppInformationInUpdateModal=function(b){if(b){var c=UC_Utils.searchObjArray(a.apps,"_id",b);if(-1!=c){var d=a.apps[c];$("#ucapp_update_nameinput").val(d.name),$("#ucapp_update_appid").val(d._id),$("#ucapp_update_appid_display").text(d._id)}}},this.validateAppInputDetails=function(){var a=$("#uc_create_newapp_nameinput").val(),b="";return""==a&&(b="Invalid App Name !"),b},this.add=function(){err()},this.switchApp=function(b){a.currentAppId=b._id,a.rivetAppNameObj.models.currentAppName=b.name,UC_UserSession.user.hasOwnProperty("app")&&UC_UserSession.user.app.hasOwnProperty(a.currentAppId)&&UC_UserSession.user.app[a.currentAppId].hasOwnProperty("currentFilter")&&(uc_main.visitorListController.currentFilterId=UC_UserSession.user.app[a.currentAppId].currentFilter),UC_UserSession.user.hasOwnProperty("app")&&UC_UserSession.user.app.hasOwnProperty(a.currentAppId)&&UC_UserSession.user.app[a.currentAppId].hasOwnProperty("filterOrder")&&UC_UserSession.user.app[a.currentAppId].filterOrder.hasOwnProperty(uc_main.visitorListController.currentFilterId)&&UC_UserSession.user.app[a.currentAppId].filterOrder[uc_main.visitorListController.currentFilterId].hasOwnProperty("currentSortColumn")&&(uc_main.visitorListController.currentSortColumn=UC_UserSession.user.app[a.currentAppId].filterOrder[uc_main.visitorListController.currentFilterId].currentSortColumn,uc_main.visitorListController.currentSortOrder=UC_UserSession.user.app[a.currentAppId].filterOrder[uc_main.visitorListController.currentFilterId].currentSortOrder),a.renderVisitors&&(uc_main.visitorListController.resetPagination(),uc_main.visitorListController.getAllVisitors(),uc_main.dashboardController.getDashboardMetrics(),uc_main.dashboardController.drawNewUsersGraph(),uc_main.filterController.listUserdefinedFilters())}}function UC_AJAXController(){var a=this;a.baseUrl="http://localhost:3000",this.get=function(b,c){var d=a.getUrl(b.endpoint);$.get(d).done(function(a,b,d){c(a,b,d)}).fail(function(b){a.ajaxError(b)})},this.post=function(b,c){var d=a.getUrl(b.endpoint);$.ajax({url:d,type:"POST",data:b.data,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a,b,d){c(a,b,d)}).fail(function(b){a.ajaxError(b)})},this.getUrl=function(b){var c=a.baseUrl;return b&&(c=c+"/"+b),c},this.call=function(b,c,d){var e={endpoint:b,data:JSON.stringify(c)};a.post(e,d)},this.ajaxError=function(a){alert("An Error accured !")}}function UC_User(){this._id="",this.firstName="",this.lastName="",this.createDate=null,this.username="",this.password="",this.company="",this.app={},this.token=null,this.cast=function(a){this._id=a._id,this.firstName=a.firstName,this.lastName=a.lastName,this.createDate=new Date(a.createDate),this.username=a.username,this.password=a.password,this.company=a.company,this.app=a.app,this.token=a.token}}function UC_App(){this._id="",this.name="",this.clientId="",this.createDate=null,this.creator="",this.cast=function(a){this._id=a._id,this.name=a.name,this.clientId=a.clientId,this.createDate=new Date(a.createDate),this.creator=a.creator}}function UC_Filter(){this._id=null,this.name="",this.filter=null,this.mongoFilter=null,this.createDate=null,this.creator=null,this.clientId=null,this.appId=null,this.cast=function(a){this._id=a._id,this.name=a.name,this.filter=mongofilter,this.mongoFilter=a.mongoFilter,this.createDate=new Date(a.createDate),this.creator=a.createDate,this.clientId=a.clientId,this.appId=a.appId}}function UC_Visitor(){this._id=null,this.appid=null,this.visitorData={name:"",email:"",created_at:null},this.visitorMetaInfo={firstSeen:null,lastSeen:null}}function UC_VisitorSession(){this._id=null,this.visitorId=null,this.agentInfo={browser:"",browserLanguage:"",os:"",platform:"",version:null},this.visitorMetaInfo={firstSeen:null,lastSeen:null}}function UC_DashboardController(){var a=this;this.metrics={},this.constructor=function(){},this.getDashboardMetrics=function(){uc_main.appController.currentAppId&&($("#ucDashboardMetricsContainer").hide(),$("#ucDashboardMetricsAjaxLoader").show(),UC_AJAX.call("DashboardManager/metrics",{appid:uc_main.appController.currentAppId},function(b,c,d){"failure"==b.status?alert("An Error accured while fetching visitors list !"):(a.metrics=b.metrics,a.listMetrics()),$("#ucDashboardMetricsContainer").show(),$("#ucDashboardMetricsAjaxLoader").hide()}))},this.listMetrics=function(){rivets.binders.faiconclass=function(a,b){a.className="fa fa-"+b.toLowerCase()},rivets.bind(document.querySelector("#uc_tab_data_dashboard"),{currentUsers:10,totalUsers:a.metrics.totalUsers,slippingAway:a.metrics.slippingAway,topBrowser:"Chrome",newUsers:a.metrics.newUsers,openIssues:10})},this.drawNewUsersGraph=function(){if(uc_main.appController.currentAppId){$("#ucNewUsersGraph").hide(),$("#ucDashboardNewUsersAjaxLoader").show(),UC_AJAX.call("DashboardManager/newusers",{appid:uc_main.appController.currentAppId,days:30},function(a,b,c){if("failure"==a.status)alert("An Error accured while fetching visitors list !");else{for(var d=a.status,e=[],f=[],g=new Date(new Date-2592e6),h=g,i=0;i<30;i++){h=new Date(h.getTime()+864e5);var j=h.getMonth()+1+"";j=1==j.length?"0"+j:j;var k=h.getDate()+"";k=1==k.length?"0"+k:k,e[i]=k+"-"+j,f[i]=0;for(var l=0;l<d.length;l++)if(d[l].date==k+"-"+j){f[i]=d[l].visitors;break}}var a={labels:e,datasets:[{label:"New Users",fill:!1,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"round",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(75,192,192,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,data:f,spanGaps:!1}]};new Chart($("#ucNewUsersGraph"),{type:"line",data:a})}$("#ucNewUsersGraph").show(),$("#ucDashboardNewUsersAjaxLoader").hide()})}}}function UC_FilterController(){var a=this;this.predefinedFiltersList=[],this.userdefinedFiltersList=[],this.rivetPredefinedFiltersListObj=null,this.rivetUserdefinedFiltersListObj=null,this.filterOnEdit=null,this.constructor=function(){uc_main.appController.renderVisitors&&(a.listPredefinedFilters(),$(document).on("click","#ucPredefinedFilterList li span, #ucUserdefinedFilterList li span",a.changeFilterHandler),$(document).on("click",".ucAddFilterBtn",a.addFilterHandler),$(document).on("click","#ucEditFilterSubmit",a.saveFilterHandler),$(document).on("click",".ucFilterSettingBtn .ico-edit",a.editFilterHandler),$(document).on("click",".ucFilterSettingBtn .ico-trash2",a.deleteFilterHandler),$("#ucUserdefinedFilterList").sortable({update:a.updateFilterOrder}),$(document).on("click","#ucMainDashboard",function(){a.changeCurrentFilter("dashboard")}))},this.initRivetBinds=function(){a.rivetPredefinedFiltersListObj=rivets.bind(document.querySelector("#ucPredefinedFilterList"),{list:a.predefinedFiltersList}),a.rivetUserdefinedFiltersListObj=rivets.bind(document.querySelector("#ucUserdefinedFilterList"),{list:a.userdefinedFiltersList})},this.listPredefinedFilters=function(){$("#ucPredefinedFilterAjaxLoader").show(),UC_AJAX.call("FilterManager/listpredefined",{user:UC_UserSession.user},function(b,c,d){"failure"==b.status?alert("An Error accured while fetching filters list"):(a.predefinedFiltersList=b.status,a.rivetPredefinedFiltersListObj.models.list=a.predefinedFiltersList),$("#ucPredefinedFilterAjaxLoader").hide()})},this.listUserdefinedFilters=function(){a.rivetUserdefinedFiltersListObj.models.list=[],$("#ucUserdefinedFilterAjaxLoader").show(),UC_AJAX.call("FilterManager/listuserdefined",{user:UC_UserSession.user,appid:uc_main.appController.currentAppId},function(b,c,d){if("failure"==b.status)alert("An Error accured while fetching filters list");else{var e=UC_UserSession.user,f=b.status;if(e.hasOwnProperty("app")&&e.app.hasOwnProperty(uc_main.appController.currentAppId)&&e.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")){var g=e.app[uc_main.appController.currentAppId].filterOrder,h=[];for(var i in g)for(var j=0;j<f.length;j++)i==f[j]._id&&h.push(f[j]);f=h}a.userdefinedFiltersList=f,a.rivetUserdefinedFiltersListObj.models.list=a.userdefinedFiltersList,"dashboard"==uc_main.visitorListController.currentFilterId?($(".ucSwitchContentContainer").hide(),$("#uc_tab_data_dashboard").show(),$(".ucSwitchContentTrigger").removeClass("ucCurrentPage"),$("#ucMainDashboard").addClass("ucCurrentPage")):($(".ucSwitchContentContainer").hide(),$("#uc_tab_data_listuser").show(),$(".ucSwitchContentTrigger").removeClass("ucCurrentPage"),$("#ucPredefinedFilterList li[data-filterid="+uc_main.visitorListController.currentFilterId+"],#ucUserdefinedFilterList li[data-filterid="+uc_main.visitorListController.currentFilterId+"]").addClass("ucCurrentPage"))}$("#ucUserdefinedFilterAjaxLoader").hide()})},this.initQueryBuilder=function(a){$("#ucFilterQueryBuilderUI").queryBuilder("destroy"),$("#ucFilterQueryBuilderUI").queryBuilder({plugins:["bt-tooltip-errors"],filters:[{id:"visitorData.name",label:"Name",type:"string"},{id:"visitorMetaInfo.lastSeen",label:"Last Seen",type:"datetime",validation:{format:"YYYY-MM-DD HH:mm:ss"},plugin:"datetimepicker",plugin_config:{format:"Y-m-d H:i:s"},input:"text",operators:["less_or_equal","greater_or_equal","between"]},{id:"sessions.agentInfo.browser",label:"Browser",type:"string"}],rules:a})},this.editFilterHandler=function(){var b=a.getFilterById($(this).closest("li").attr("data-filterid"));a.filterOnEdit=b,a.initQueryBuilder(JSON.parse(b.filter)),$("#ucFilterName").val(b.name),$("#ucEditFilterModal").modal(),$("#ucUpdateFilterAjaxLoader").hide(),$(".rule-container .rule-actions .btn-danger").text(""),$(".rule-container .rule-actions .btn-danger").addClass("ucListingFilterDeleteIcon"),$("#ucFilterQueryBuilderUI").on("afterAddRule.queryBuilder",function(a,b,c,d){$(".rule-container .rule-actions .btn-danger").text(""),$(".rule-container .rule-actions .btn-danger").addClass("ucListingFilterDeleteIcon")})},this.getFilterById=function(b){for(var c=0;c<a.userdefinedFiltersList.length;c++){var d=a.userdefinedFiltersList[c];if(d._id==b)return d}return!1},this.addFilterHandler=function(){a.filterOnEdit=null,a.initQueryBuilder(null),$("#ucFilterName").val(""),$("#ucEditFilterModal").modal(),$(".rule-container .rule-actions .btn-danger").text(""),$(".rule-container .rule-actions .btn-danger").addClass("ucListingFilterDeleteIcon"),$("#ucFilterQueryBuilderUI").on("afterAddRule.queryBuilder",function(a,b,c,d){$(".rule-container .rule-actions .btn-danger").text(""),$(".rule-container .rule-actions .btn-danger").addClass("ucListingFilterDeleteIcon")})},this.saveFilterHandler=function(){var b=$("#ucFilterQueryBuilderUI").queryBuilder("getRules");$.isEmptyObject(b)||(b=JSON.stringify(b,null,2));var c=$("#ucFilterQueryBuilderUI").queryBuilder("getMongo");$.isEmptyObject(c)||(c=JSON.stringify(c,null,2));var d=$("#ucFilterName").val();if(""==$.trim(d))return void alert("Filter Name is Required");if(null==a.filterOnEdit){var e=new UC_Filter;e._id="F"+UC_Utils.guidGenerator(),e.creator=UC_UserSession.user._id,e.clientId=UC_UserSession.user.company,e.appId=uc_main.appController.currentAppId,e.name=d,e.filter=b,e.mongoFilter=c,a.userdefinedFiltersList.push(e),UC_UserSession.user.hasOwnProperty("app")||(UC_UserSession.user.app={}),UC_UserSession.user.app.hasOwnProperty(uc_main.appController.currentAppId)||(UC_UserSession.user.app[uc_main.appController.currentAppId]={}),UC_UserSession.user.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")?UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[e._id]={currentSortColumn:"visitorMetaInfo.lastSeen",currentSortOrder:1}:a.updateFilterOrder(),a.saveAppPreference()}else{var e=a.filterOnEdit;e.name=d,e.filter=b,e.mongoFilter=c}$("#ucUpdateFilterAjaxLoader").show(),
UC_AJAX.call("FilterManager/updateFilter",{filter:e},function(b,c,d){b&&("failure"==b.status?alert("An Error accured while saving data !"):($("#ucEditFilterModal").modal("hide"),a.listUserdefinedFilters(),uc_main.visitorListController.currentFilterId==e._id&&(uc_main.visitorListController.resetPagination(),uc_main.visitorListController.getAllVisitors()))),$("#ucUpdateFilterAjaxLoader").hide()})},this.changeFilterHandler=function(){$("#uc_tab_data_dashboard").hide(),$("#uc_tab_data_listuser").show();var b=$(this).closest("li").attr("data-filterid");a.changeCurrentFilter(b),uc_main.visitorListController.resetPagination(),uc_main.visitorListController.getAllVisitors()},this.deleteFilterHandler=function(){var b=a.getFilterById($(this).closest("li").attr("data-filterid"));if(confirm("Are you sure that you want to delete the filter?")){for(var c=0;c<a.userdefinedFiltersList.length;c++){var d=a.userdefinedFiltersList[c];b._id==d._id&&(a.userdefinedFiltersList.splice(c,1),c--)}UC_UserSession.user.hasOwnProperty("app")&&UC_UserSession.user.app.hasOwnProperty(uc_main.appController.currentAppId)&&UC_UserSession.user.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")&&delete UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[b._id],uc_main.visitorListController.currentFilterId==b._id&&(a.changeCurrentFilter("1"),uc_main.visitorListController.resetPagination(),uc_main.visitorListController.getAllVisitors()),UC_AJAX.call("FilterManager/deleteFilter",{filter:b},function(b,c,d){b&&("failure"==b.status?alert("An Error accured while deleting"):a.listUserdefinedFilters())})}},this.updateFilterOrder=function(b,c){var d={};UC_UserSession.user.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")&&(d=UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder);var e={};$("#ucUserdefinedFilterList li").each(function(){d.hasOwnProperty($(this).attr("data-filterid"))?e[$(this).attr("data-filterid")]=d[$(this).attr("data-filterid")]:e[$(this).attr("data-filterid")]={currentSortColumn:"visitorMetaInfo.lastSeen",currentSortOrder:1}}),UC_UserSession.user.hasOwnProperty("app")||(UC_UserSession.user.app={}),UC_UserSession.user.app.hasOwnProperty(uc_main.appController.currentAppId)||(UC_UserSession.user.app[uc_main.appController.currentAppId]={}),UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder=e,a.saveAppPreference()},this.saveAppPreference=function(){UC_AJAX.call("UserManager/updateAppPreference",{user:UC_UserSession.user},function(a,b,c){a&&"failure"==a.status&&alert("An Error accured while saving data")})},this.changeCurrentFilter=function(b){uc_main.visitorListController.currentFilterId=b,UC_UserSession.user.hasOwnProperty("app")||(UC_UserSession.user.app={}),UC_UserSession.user.app.hasOwnProperty(uc_main.appController.currentAppId)||(UC_UserSession.user.app[uc_main.appController.currentAppId]={}),UC_UserSession.user.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")||(UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder={}),UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder.hasOwnProperty(b)||(UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[b]={currentSortColumn:"visitorMetaInfo.lastSeen",currentSortOrder:1}),UC_UserSession.user.app[uc_main.appController.currentAppId].currentFilter=b,uc_main.visitorListController.currentSortColumn=UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[b].currentSortColumn,uc_main.visitorListController.currentSortOrder=UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[b].currentSortOrder,a.saveAppPreference()},this.selectCurrentFilter=function(){$("#ucPredefinedFilterList li,#ucUserdefinedFilterList li").removeClass("ucCurrentFilter"),$("#ucPredefinedFilterList li[data-filterid='"+uc_main.visitorListController.currentFilterId+"']").addClass("ucCurrentFilter"),$("#ucUserdefinedFilterList li[data-filterid='"+uc_main.visitorListController.currentFilterId+"']").addClass("ucCurrentFilter")}}function UC_MainController(){var a=this;this.appController=new UC_AppController,this.dashboardController=new UC_DashboardController,this.visitorListController=new UC_VisitorListController,this.userController=new UC_UserController,this.filterController=new UC_FilterController,this.messagingController=new UC_MessagingController,this.rivetUserNameObj=null,this.constructor=function(){a.appController.constructor(),a.dashboardController.constructor(),a.visitorListController.constructor(),a.userController.constructor(),a.filterController.constructor(),a.messagingController.constructor(),a.initRivetBinds(),$(".uc_tab_trigger").on("click",a.toggleTabs),$(document).on("click",".ucSwitchContentTrigger",a.switchContent),$(".ucSwitchContentContainer").hide(),$("#uc_tab_data_dashboard").show(),$("#ucMainDashboard").addClass("ucCurrentPage"),$(".ucSideBarMenuTrigger").on("click",a.menuContainer),$(".ucSidebarCloseBtn").on("click",a.closeMenuContainer),$(".mfTooltip").tooltip()},this.initRivetBinds=function(){a.rivetUserNameObj=rivets.bind(document.querySelector("#uc_currentuser_name"),{currentUserName:UC_UserSession.user.firstName+" "+UC_UserSession.user.lastName})},this.toggleTabs=function(){$("."+$(this).attr("data-tabgroup-class")).hide(),$("#"+$(this).attr("data-tabgroup-tabid")).show(),$(this).closest(".btn-group").find(".btn").removeClass("active"),$(this).addClass("active")},this.switchContent=function(b){var c=$(this).attr("switch-to");$(".ucSwitchContentContainer").hide(),$("#"+c).show(),$(".ucSwitchContentTrigger").removeClass("ucCurrentPage"),$(this).addClass("ucCurrentPage"),a.closeMenuContainer(b)},this.menuContainer=function(a){a.stopPropagation(),$(".ucSidebar,.ucMainContent,.ucIndexPageWrapper, body,  #ucHeader").hasClass("open")?($(".ucSidebar,.ucMainContent,.ucIndexPageWrapper, body , #ucHeader").removeClass("open"),$("html, body").css({overflow:"auto"})):($(".ucSidebar,.ucMainContent, .ucIndexPageWrapper, body , #ucHeader").addClass("open"),$("html, body").css({overflow:"hidden"}))},this.closeMenuContainer=function(a){a.stopPropagation(),$(".ucSidebar,.ucMainContent,.ucIndexPageWrapper, body , #ucHeader").removeClass("open"),$("html, body").css({overflow:"auto"})}}function UC_EmailMessagingController(){var a=this;this.rivetEmailTemplateListObj=null,this.rivetFieldListObj=null,this.emailTemplateList=[],this.constructor=function(){$(document).on("click","#ucSendMessageGroupBtn",a.openSendMessageModal),$(document).on("click","#ucSendMessageSubmit",a.submitMessageHandler),$(document).on("click",".ucSendMessageSingleTrigger",a.selectCurrentVisitor),$(document).on("change","#ucSendMessageTemplate",a.templateChangeHandler),a.rivetEmailTemplateListObj=rivets.bind(document.querySelector("#ucSendMessageTemplate"),{emailTemplateList:a.emailTemplateList}),a.rivetFieldListObj=rivets.bind(document.querySelector("#ucEmailFieldList"),{fieldList:[]})},this.openSendMessageModal=function(){$("#ucSendMessageModal").modal(),$("#ucSendMessageAjaxLoader").hide(),UC_AJAX.call("EmailManager/getemailtemplates",{appid:uc_main.appController.currentAppId,user:UC_UserSession.user},function(b,c,d){"failure"==b.status?alert("Could not send emails, kindly check the SMTP settings"):(a.emailTemplateList=b.emailTemplateList,a.rivetEmailTemplateListObj.models.emailTemplateList=a.emailTemplateList,$("#ucSendMessageTemplate option:eq(0)").prop("selected",!0),$("#ucSendMessageSubject,#ucSendMessageBody").val(""))}),UC_AJAX.call("VisitorListManager/getfieldslist",{appid:uc_main.appController.currentAppId,user:UC_UserSession.user},function(b,c,d){if("failure"==b.status)alert("Could not send emails, kindly check the SMTP settings");else{for(var e=0;e<b.fields.length;e++)b.fields[e]="{"+b.fields[e]+"}";a.rivetFieldListObj.models.fieldList=b.fields}})},this.submitMessageHandler=function(){var a=null,b=[],c=[],d=$("#ucSendMessageSubject").val(),e=$("#ucSendMessageBody").val(),f=$("#ucSendMessageTemplate").val(),g=!1;$("#ucSendMessageBlockDuplicate").is(":checked")&&(g=!0),$("#uc-all-user-select").is(":checked")?(a=uc_main.visitorListController.currentFilterId,$(".uc-user-select").each(function(){$(this).is(":checked")||b.push($(this).attr("data-visitorid"))})):$(".uc-user-select").each(function(){$(this).is(":checked")&&c.push($(this).attr("data-visitorid"))}),$("#ucSendMessageAjaxLoader").show(),UC_AJAX.call("EmailManager/sendmessage",{appid:uc_main.appController.currentAppId,user:UC_UserSession.user,filterId:a,exclusionList:b,inclusionList:c,subject:d,message:e,template:f,blockDuplicate:g},function(a,b,c){"failure"==a.status?alert("Could not send emails, kindly check the SMTP settings"):$("#ucSendMessageModal").modal("hide"),$("#ucSendMessageAjaxLoader").hide()})},this.selectCurrentVisitor=function(){$("#uc-all-user-select").prop("checked",!1),$(".uc-user-select").prop("checked",!1),uc_main.visitorListController.userListSelectHandler(),$(this).closest("tr").find(".uc-user-select").prop("checked",!0),a.openSendMessageModal()},this.templateChangeHandler=function(){"new"==$(this).val()?$("#ucSendMessageSubject,#ucSendMessageBody").val(""):($("#ucSendMessageSubject").val($(this).find("option:selected").text()),$("#ucSendMessageBody").val($(this).find("option:selected").attr("data-templatebody")))}}function UC_MessagingController(){var a=this;this.emailMessagingController=new UC_EmailMessagingController,this.constructor=function(){a.emailMessagingController.constructor()}}function UC_VisitorListController(){var a=this;this.visitors=[],this.visitorListPageLimit=30,this.visitorListSkipIndex=0,this.visitorListLoaded=!1,this.rivetVisitorListObj=null,this.rivetVisitorDetailsObj=null,this.rivetVisitorMessagesObj=null,this.currentFilterId="dashboard",this.currentSortColumn="visitorMetaInfo.lastSeen",this.currentSortOrder=1,this.currentFilterTotalVisitors=0,this.constructor=function(){uc_main.appController.renderVisitors&&($(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&(a.visitorListLoaded||a.getAllVisitors())}),$(document).on("click",".ucUserListSortableColumn",a.sortUserList),$(document).on("click",".ucVisitorPageTrigger",a.openVisitorProfile),$("#uc_visitor_list .ucUserListSortableColumn .fa-caret-up").hide(),$("#uc_visitor_list .ucUserListSortableColumn .fa-caret-down").hide(),$(document).on("click","#uc-all-user-select",a.userListSelectHandler),$(document).on("change","#uc-all-user-select,.uc-user-select",a.updateRecipientCount))},this.initRivetBinds=function(){a.rivetVisitorListObj=rivets.bind(document.querySelector("#uc_visitor_list"),{list:a.visitors}),rivets.binders.visitorid=function(a,b){$(a).attr("id","uc-user-select-"+b._id),$(a).attr("data-visitorid",b._id),$(a).next("label").attr("for","uc-user-select-"+b._id)},rivets.binders.latestbrowser=function(a,b){var c=b[0].agentInfo.browser,d=b[0].agentInfo.version,e=d.split(".");e.length>2&&(d=e[0]+"."+e[1]),$(a).html(c+" <span>(v"+d+")</span>"),$(a).removeClass("chrome safari firefox edge ie"),$(a).addClass(c.toLowerCase())},rivets.binders.latestplatform=function(a,b){var c=b[0].agentInfo.os,d="windows";"macos"==c.toLowerCase().substr(0,5)&&(d="ios"),$(a).html(c),$(a).removeClass("ios android windows linux"),$(a).addClass(d)},rivets.binders.sessioncount=function(a,b){$(a).html(b.length)}},this.getAllVisitors=function(){if(uc_main.appController.currentAppId){var b=a.currentFilterId;"dashboard"==b&&(b="1"),a.rivetVisitorListObj.models.list=[],$("#ucVisitorListAjaxLoader").show(),UC_AJAX.call("VisitorListManager/visitorlist",{appid:uc_main.appController.currentAppId,skipindex:a.visitorListSkipIndex,pagelimit:a.visitorListPageLimit,filterid:b,sortColumn:a.currentSortColumn,sortOrder:a.currentSortOrder},function(b,c,d){"failure"==b.status?alert("An Error accured while fetching visitors list !"):(1==b.totalcount.length?a.currentFilterTotalVisitors=b.totalcount[0].count:a.currentFilterTotalVisitors=0,a.visitors=a.visitors.concat(b.status),a.visitorListSkipIndex=a.visitorListSkipIndex+b.status.length,0==b.status.length&&(a.visitorListLoaded=!0),a.listVisitors()),$("#ucVisitorListAjaxLoader").hide()})}},this.listVisitors=function(){a.rivetVisitorListObj.models.list=a.visitors,a.selectCurrentSort()},this.sortUserList=function(){var b=$(this).attr("data-sortColumn");b==a.currentSortColumn?1===a.currentSortOrder?a.currentSortOrder=-1:a.currentSortOrder=1:(a.currentSortColumn=b,a.currentSortOrder=-1),UC_UserSession.user.hasOwnProperty("app")||(UC_UserSession.user.app={}),UC_UserSession.user.app.hasOwnProperty(uc_main.appController.currentAppId)||(UC_UserSession.user.app[uc_main.appController.currentAppId]={}),UC_UserSession.user.app[uc_main.appController.currentAppId].hasOwnProperty("filterOrder")||(UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder={}),UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder.hasOwnProperty(a.currentFilterId)||(UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[a.currentFilterId]={currentSortColumn:"visitorMetaInfo.lastSeen",currentSortOrder:1}),UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[a.currentFilterId].currentSortColumn=a.currentSortColumn,UC_UserSession.user.app[uc_main.appController.currentAppId].filterOrder[a.currentFilterId].currentSortOrder=a.currentSortOrder,uc_main.filterController.saveAppPreference(),a.resetPagination(),a.getAllVisitors()},this.resetPagination=function(){a.visitors=[],a.visitorListSkipIndex=0,a.visitorListLoaded=!1,$("#uc-all-user-select").prop("checked",!1)},this.openVisitorProfile=function(){location.href="/visitor/"+$(this).attr("data-visitorid")},this.selectCurrentSort=function(){$("#uc_visitor_list .ucUserListSortableColumn .fa-caret-up").hide(),$("#uc_visitor_list .ucUserListSortableColumn .fa-caret-down").hide(),1===a.currentSortOrder?$("#uc_visitor_list .ucUserListSortableColumn[data-sortColumn='"+a.currentSortColumn+"'] .fa-caret-up").show():$("#uc_visitor_list .ucUserListSortableColumn[data-sortColumn='"+a.currentSortColumn+"'] .fa-caret-down").show()},this.userListSelectHandler=function(){$("#uc-all-user-select").is(":checked")?($(".uc-user-select").prop("checked",!0),$("#ucSendMessageGroupBtn").text("Send Message to All"),$("#ucSendMessageSubmit").text("Send to All")):($(".uc-user-select").prop("checked",!1),$("#ucSendMessageGroupBtn").text("Send Message"),$("#ucSendMessageSubmit").text("Send"))},this.updateRecipientCount=function(){var b=0;$("#uc-all-user-select").is(":checked")?(b=a.currentFilterTotalVisitors,$(".uc-user-select").each(function(){$(this).is(":checked")||b--})):$(".uc-user-select").each(function(){$(this).is(":checked")&&b++}),$("#ucSendMessageGroupBtn,#ucSendMessageSubmit").text("Send Message to "+b+" users")},this.getVisitorDetails=function(b){null!=b&&($("#ucVisitorDetailAjaxLoader").show(),UC_AJAX.call("VisitorListManager/getvisitordetails",{appid:uc_main.appController.currentAppId,visitorId:b},function(b,c,d){if("failure"==b.status)alert("An Error accured while fetching user details !");else{if(null!=b.visitor){var e=b.visitor;e.displayId=e._id.substring(0,10)+"...",e.displaySessionCount=e.sessions.length,e.displayLastSeen=moment(e.visitorMetaInfo.lastSeen).format("DD MMM YYYY HH:mm:ss"),e.displayFirstSeen=moment(e.visitorMetaInfo.firstSeen).format("DD MMM YYYY HH:mm:ss"),a.rivetVisitorDetailsObj=rivets.bind(document.querySelector("#ucVisitorDetail"),{visitor:e})}$("#ucVisitorDetailAjaxLoader").hide(),$("#ucVisitorDetailTable").show()}}),$("#ucVisitorMessageAjaxLoader").show(),UC_AJAX.call("VisitorListManager/getvisitormessages",{appid:uc_main.appController.currentAppId,visitorId:b},function(b,c,d){if("failure"==b.status)alert("An Error accured while fetching user details !");else{if(null!=b.messages){for(var e=b.messages,f=0;f<e.length;f++)e[f].displayDate=moment(e[f].sentOn).format("DD MMM YYYY HH:mm:ss");a.rivetVisitorMessagesObj=rivets.bind(document.querySelector("#ucVisitorMessages"),{messageList:e})}$("#ucVisitorMessageAjaxLoader").hide(),$("#ucVisitorMessages").show()}}))}}var UC_AJAX=new UC_AJAXController,UC_UserSession={user:null,getUser:function(){return this.user}},UC_Utils=function(){return{guidGenerator:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+a()+a()+a()+a()+a()+a()},isValidEmail:function(a){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)},searchObjArray:function(a,b,c){var d=-1;return a.forEach(function(a,e){if(a[b]===c)return void(d=e)}),d},getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}}}();!function(a,b){"use strict";var c="https:"===b.location.protocol?"https://":"http://",d={api_host:c+"localhost:3000"},e={guidGenerator:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+a()+a()+a()+a()+a()+a()},extendObj:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}},f={createCookie:function(a,c,d){var e="";if(d){var f=new Date;f.setTime(f.getTime()+24*d*60*60*1e3),e="; expires="+f.toUTCString()}b.cookie=a+"="+c+e+"; path=/"},readCookie:function(a){for(var c=a+"=",d=b.cookie.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1,f.length);if(0==f.indexOf(c))return f.substring(c.length,f.length)}return null},eraseCookie:function(a){createCookie(a,"",-1)}},g={formdata:function(b,c,d){try{var e=new XMLHttpRequest;e.open(c?"POST":"GET",b,1),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){e.readyState>3&&callback&&callback(e.responseText,e)},e.send(c)}catch(b){a.console&&console.log(b)}},raw:function(b,c,d){try{var e=new XMLHttpRequest;e.open(c?"POST":"GET",b,1),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){e.readyState>3&&d&&d(e.responseText,e)},e.send(c)}catch(b){a.console&&console.log(b)}}},h={appid:null,userData:null,track:function(a,b){if(!a||0==a.length)return void console.error("Usercom Error: Event name not provided !");var c={appid:this.appid,userdata:this.userData,properties:b,eventname:a,uid:e.guidGenerator()};g.raw(d.api_host+"/VisitorTrackingManager/event",JSON.stringify(c),function(a){console.log(a)})}},i={init:function(b,c){if(!b||0==b.length)return void console.error("Usercom Error: Invalid app id !");var c=c||{};h.appid=b,h.userData=c;var i={appid:b,userdata:c,uid:e.guidGenerator(),screenResolution:screen.width+"x"+screen.height,timezone:-(new Date).getTimezoneOffset()/60};g.raw(d.api_host+"/VisitorTrackingManager/ping",JSON.stringify(i),function(a){console.log(a)}),a.onbeforeunload=function(){var a={appid:b,userdata:c,uid:i.uid,sessionStart:sessionstart};g.raw(d.api_host+"/VisitorTrackingManager/logout",JSON.stringify(a),function(a){})},a.Usercom=h,f.readCookie("usercomio_session")||f.createCookie("usercomio_session",e.guidGenerator()),this.bindGlobalErrorHandler(h)},bindGlobalErrorHandler:function(b){var c=a.onerror;a.onerror=function(a,f,h,i,j){c&&c.apply(this,arguments);var k=["Message: "+a,"URL: "+f,"Line: "+h,"Column: "+i,"Error object: "+JSON.stringify(j)].join(" - "),l={appid:b.appid,userdata:b.userData,errormsg:k,uid:e.guidGenerator()};return g.raw(d.api_host+"/VisitorTrackingManager/error",JSON.stringify(l),function(a){console.log(a)}),!1}}};a.Usercom=i}(window,document);