<<<<<<< HEAD
var Units = [
  '%',
  'ch',
  'cm',
  'em',
  'ex',
  'in',
  'mm',
  'pc',
  'pt',
  'px',
  'rem',
  'vh',
  'vm',
  'vmax',
  'vmin',
  'vw'
];
var cssUnitRegexStr = '(\\-?\\.?\\d+\\.?\\d*(' + Units.join('|') + '|)|auto|inherit)';
var cssCalcRegexStr = '(\\-moz\\-|\\-webkit\\-)?calc\\([^\\)]+\\)';
var cssFunctionNoVendorRegexStr = '[A-Z]+(\\-|[A-Z]|[0-9])+\\(.*?\\)';
var cssFunctionVendorRegexStr = '\\-(\\-|[A-Z]|[0-9])+\\(.*?\\)';
var cssVariableRegexStr = 'var\\(\\-\\-[^\\)]+\\)';
var cssFunctionAnyRegexStr = '(' + cssVariableRegexStr + '|' + cssFunctionNoVendorRegexStr + '|' + cssFunctionVendorRegexStr + ')';
var cssUnitOrCalcRegexStr = '(' + cssUnitRegexStr + '|' + cssCalcRegexStr + ')';

var cssFunctionNoVendorRegex = new RegExp('^' + cssFunctionNoVendorRegexStr + '$', 'i');
var cssVariableRegex = new RegExp('^' + cssVariableRegexStr + '$', 'i');
var cssFunctionAnyRegex = new RegExp('^' + cssFunctionAnyRegexStr + '$', 'i');
var cssUnitRegex = new RegExp('^' + cssUnitRegexStr + '$', 'i');
var cssUnitOrCalcRegex = new RegExp('^' + cssUnitOrCalcRegexStr + '$', 'i');

var urlRegex = /^url\([\s\S]+\)$/i;

var globalKeywords = [
  'inherit',
  'initial',
  'unset'
];

var Keywords = {
=======
var functionNoVendorRegexStr = '[A-Z]+(\\-|[A-Z]|[0-9])+\\(.*?\\)';
var functionVendorRegexStr = '\\-(\\-|[A-Z]|[0-9])+\\(.*?\\)';
var variableRegexStr = 'var\\(\\-\\-[^\\)]+\\)';
var functionAnyRegexStr = '(' + variableRegexStr + '|' + functionNoVendorRegexStr + '|' + functionVendorRegexStr + ')';

var animationTimingFunctionRegex = /^(cubic\-bezier|steps)\([^\)]+\)$/;
var calcRegex = new RegExp('^(\\-moz\\-|\\-webkit\\-)?calc\\([^\\)]+\\)$', 'i');
var functionAnyRegex = new RegExp('^' + functionAnyRegexStr + '$', 'i');
var hslColorRegex = /^hsl\(\s*[\-\.\d]+\s*,\s*[\.\d]+%\s*,\s*[\.\d]+%\s*\)|hsla\(\s*[\-\.\d]+\s*,\s*[\.\d]+%\s*,\s*[\.\d]+%\s*,\s*[\.\d]+\s*\)$/;
var identifierRegex = /^(\-[a-z0-9_][a-z0-9\-_]*|[a-z][a-z0-9\-_]*)$/i;
var longHexColorRegex = /^#[0-9a-f]{6}$/i;
var namedEntityRegex = /^[a-z]+$/i;
var prefixRegex = /^-([a-z0-9]|-)*$/i;
var rgbColorRegex = /^rgb\(\s*[\d]{1,3}\s*,\s*[\d]{1,3}\s*,\s*[\d]{1,3}\s*\)|rgba\(\s*[\d]{1,3}\s*,\s*[\d]{1,3}\s*,\s*[\d]{1,3}\s*,\s*[\.\d]+\s*\)$/;
var shortHexColorRegex = /^#[0-9a-f]{3}$/i;
var timeRegex = new RegExp('^(\\-?\\+?\\.?\\d+\\.?\\d*(s|ms))$');
var urlRegex = /^url\([\s\S]+\)$/i;
var variableRegex = new RegExp('^' + variableRegexStr + '$', 'i');

var Keywords = {
  '^': [
    'inherit',
    'initial',
    'unset'
  ],
>>>>>>> upstream/master
  '*-style': [
    'auto',
    'dashed',
    'dotted',
    'double',
    'groove',
    'hidden',
    'inset',
    'none',
    'outset',
    'ridge',
    'solid'
  ],
<<<<<<< HEAD
=======
  'animation-direction': [
    'alternate',
    'alternate-reverse',
    'normal',
    'reverse'
  ],
  'animation-fill-mode': [
    'backwards',
    'both',
    'forwards',
    'none'
  ],
  'animation-iteration-count': [
    'infinite'
  ],
  'animation-name': [
    'none'
  ],
  'animation-play-state': [
    'paused',
    'running'
  ],
  'animation-timing-function': [
    'ease',
    'ease-in',
    'ease-in-out',
    'ease-out',
    'linear',
    'step-end',
    'step-start'
  ],
>>>>>>> upstream/master
  'background-attachment': [
    'fixed',
    'inherit',
    'local',
    'scroll'
  ],
  'background-clip': [
    'border-box',
    'content-box',
    'inherit',
    'padding-box',
    'text'
  ],
  'background-origin': [
    'border-box',
    'content-box',
    'inherit',
    'padding-box'
  ],
  'background-position': [
    'bottom',
    'center',
    'left',
    'right',
    'top'
  ],
  'background-repeat': [
    'no-repeat',
    'inherit',
    'repeat',
    'repeat-x',
    'repeat-y',
    'round',
    'space'
  ],
  'background-size': [
    'auto',
    'cover',
    'contain'
  ],
  'border-collapse': [
    'collapse',
    'inherit',
    'separate'
  ],
  'bottom': [
    'auto'
  ],
  'clear': [
    'both',
    'left',
    'none',
    'right'
  ],
<<<<<<< HEAD
=======
  'color': [
    'transparent'
  ],
>>>>>>> upstream/master
  'cursor': [
    'all-scroll',
    'auto',
    'col-resize',
    'crosshair',
    'default',
    'e-resize',
    'help',
    'move',
    'n-resize',
    'ne-resize',
    'no-drop',
    'not-allowed',
    'nw-resize',
    'pointer',
    'progress',
    'row-resize',
    's-resize',
    'se-resize',
    'sw-resize',
    'text',
    'vertical-text',
    'w-resize',
    'wait'
  ],
  'display': [
    'block',
    'inline',
    'inline-block',
    'inline-table',
    'list-item',
    'none',
    'table',
    'table-caption',
    'table-cell',
    'table-column',
    'table-column-group',
    'table-footer-group',
    'table-header-group',
    'table-row',
    'table-row-group'
  ],
  'float': [
    'left',
    'none',
    'right'
  ],
  'left': [
    'auto'
  ],
<<<<<<< HEAD
=======
  'font': [
    'caption',
    'icon',
    'menu',
    'message-box',
    'small-caption',
    'status-bar',
    'unset'
  ],
  'font-size': [
    'large',
    'larger',
    'medium',
    'small',
    'smaller',
    'x-large',
    'x-small',
    'xx-large',
    'xx-small'
  ],
  'font-stretch': [
    'condensed',
    'expanded',
    'extra-condensed',
    'extra-expanded',
    'normal',
    'semi-condensed',
    'semi-expanded',
    'ultra-condensed',
    'ultra-expanded'
  ],
>>>>>>> upstream/master
  'font-style': [
    'italic',
    'normal',
    'oblique'
  ],
<<<<<<< HEAD
=======
  'font-variant': [
    'normal',
    'small-caps'
  ],
>>>>>>> upstream/master
  'font-weight': [
    '100',
    '200',
    '300',
    '400',
    '500',
    '600',
    '700',
    '800',
    '900',
    'bold',
    'bolder',
    'lighter',
    'normal'
  ],
<<<<<<< HEAD
=======
  'line-height': [
    'normal'
  ],
>>>>>>> upstream/master
  'list-style-position': [
    'inside',
    'outside'
  ],
  'list-style-type': [
    'armenian',
    'circle',
    'decimal',
    'decimal-leading-zero',
    'disc',
    'decimal|disc', // this is the default value of list-style-type, see comment in compactable.js
    'georgian',
    'lower-alpha',
    'lower-greek',
    'lower-latin',
    'lower-roman',
    'none',
    'square',
    'upper-alpha',
    'upper-latin',
    'upper-roman'
  ],
  'overflow': [
    'auto',
    'hidden',
    'scroll',
    'visible'
  ],
  'position': [
    'absolute',
    'fixed',
    'relative',
    'static'
  ],
  'right': [
    'auto'
  ],
  'text-align': [
    'center',
    'justify',
    'left',
    'left|right', // this is the default value of list-style-type, see comment in compactable.js
    'right'
  ],
  'text-decoration': [
    'line-through',
    'none',
    'overline',
    'underline'
  ],
  'text-overflow': [
    'clip',
    'ellipsis'
  ],
  'top': [
    'auto'
  ],
  'vertical-align': [
    'baseline',
    'bottom',
    'middle',
    'sub',
    'super',
    'text-bottom',
    'text-top',
    'top'
  ],
  'visibility': [
    'collapse',
    'hidden',
    'visible'
  ],
  'white-space': [
    'normal',
    'nowrap',
    'pre'
  ],
  'width': [
    'inherit',
    'initial',
    'medium',
    'thick',
    'thin'
  ]
};

<<<<<<< HEAD
var VENDOR_PREFIX_PATTERN = /(^|\W)-\w+\-/;

function areSameFunction(value1, value2) {
  if (!isValidFunction(value1) || !isValidFunction(value2)) {
    return false;
  }

  var function1Name = value1.substring(0, value1.indexOf('('));
  var function2Name = value2.substring(0, value2.indexOf('('));

  return function1Name === function2Name;
}

function hasNoVendorPrefix(value) {
  return VENDOR_PREFIX_PATTERN.test(value);
}

function isValidBackgroundAttachment(value) {
  return Keywords['background-attachment'].indexOf(value) > -1;
}

function isValidBackgroundClip(value) {
  return Keywords['background-clip'].indexOf(value) > -1;
}

function isValidBackgroundRepeat(value) {
  return Keywords['background-repeat'].indexOf(value) > -1;
}

function isValidBackgroundOrigin(value) {
  return Keywords['background-origin'].indexOf(value) > -1;
}

function isValidBackgroundPosition(value) {
  var parts;
  var i, l;

  if (value === 'inherit') {
    return true;
  }

  parts = value.split(' ');
  for (i = 0, l = parts.length; i < l; i++) {
    if (parts[i] === '') {
      continue;
    } else if (isValidBackgroundPositionPart(parts[i])) {
      continue;
    }

    return false;
  }

  return true;
}

function isValidBackgroundPositionPart(value) {
  return Keywords['background-position'].indexOf(value) > -1 || cssUnitOrCalcRegex.test(value);
}

function isValidBackgroundSizePart(value) {
  return Keywords['background-size'].indexOf(value) > -1 || cssUnitRegex.test(value);
}

function isValidColor(value) {
  return isValidNamedColor(value) ||
    isValidColorValue(value);
}

function isValidColorValue(value) {
  return isValidHexColor(value) ||
    isValidRgbaColor(value) ||
    isValidHslaColor(value);
}

function isValidFunction(value) {
  return !urlRegex.test(value) && cssFunctionAnyRegex.test(value);
}

function isValidFunctionWithoutVendorPrefix(value) {
  return !urlRegex.test(value) && cssFunctionNoVendorRegex.test(value);
}

function isValidGlobalValue(value) {
  return globalKeywords.indexOf(value) > -1;
}

function isValidHexColor(value) {
  return (value.length === 4 || value.length === 7) && value[0] === '#';
}

function isValidHslaColor(value) {
  return value.length > 0 && value.indexOf('hsla(') === 0 && value.indexOf(')') === value.length - 1;
}

function isValidImage(value) {
  return value == 'none' || value == 'inherit' || isValidUrl(value);
}

function isValidKeywordValue(propertyName, value, includeGlobal) {
  return Keywords[propertyName].indexOf(value) > -1 || includeGlobal && isValidGlobalValue(value);
}

function isValidListStyleType(value) {
  return Keywords['list-style-type'].indexOf(value) > -1;
}

function isValidListStylePosition(value) {
  return Keywords['list-style-position'].indexOf(value) > -1;
}

function isValidNamedColor(value) {
  // We don't really check if it's a valid color value, but allow any letters in it
  return value !== 'auto' && (value === 'transparent' || value === 'inherit' || /^[a-zA-Z]+$/.test(value));
}

function isValidRgbaColor(value) {
  return value.length > 0 && value.indexOf('rgba(') === 0 && value.indexOf(')') === value.length - 1;
}

function isValidStyle(value) {
  return Keywords['*-style'].indexOf(value) > -1;
}

function isValidTextShadow(compatibleCssUnitRegex, value) {
  return isValidUnitWithoutFunction(compatibleCssUnitRegex, value) ||
    isValidColor(value) ||
    isValidGlobalValue(value);
}

function isValidUnit(compatibleCssUnitAnyRegex, value) {
  return compatibleCssUnitAnyRegex.test(value);
}

function isValidUnitWithoutFunction(compatibleCssUnitRegex, value) {
  return compatibleCssUnitRegex.test(value);
}

function isValidUrl(value) {
  return urlRegex.test(value);
}

function isValidVariable(value) {
  return cssVariableRegex.test(value);
}

function isValidVendorPrefixedValue(value) {
  return /^-([A-Za-z0-9]|-)*$/gi.test(value);
}

function isValidWidth(compatibleCssUnitRegex, value) {
  return isValidUnit(compatibleCssUnitRegex, value) || Keywords.width.indexOf(value) > -1;
}

function isValidZIndex(value) {
  return value == 'auto' ||
    isValidGlobalValue(value) ||
    value.length > 0 && value == ('' + parseInt(value));
=======
var Units = [
  '%',
  'ch',
  'cm',
  'em',
  'ex',
  'in',
  'mm',
  'pc',
  'pt',
  'px',
  'rem',
  'vh',
  'vm',
  'vmax',
  'vmin',
  'vw'
];

function isAnimationTimingFunction() {
  var isTimingFunctionKeyword = isKeyword('animation-timing-function');

  return function (value) {
    return isTimingFunctionKeyword(value) || animationTimingFunctionRegex.test(value);
  };
}

function isColor(value) {
  return value != 'auto' &&
    (
      isKeyword('color')(value) ||
      isHexColor(value) ||
      isColorFunction(value) ||
      isNamedEntity(value)
    );
}

function isColorFunction(value) {
  return isRgbColor(value) || isHslColor(value);
}

function isDynamicUnit(value) {
  return calcRegex.test(value);
}

function isFunction(value) {
  return functionAnyRegex.test(value);
}

function isHexColor(value) {
  return shortHexColorRegex.test(value) || longHexColorRegex.test(value);
}

function isHslColor(value) {
  return hslColorRegex.test(value);
}

function isIdentifier(value) {
  return identifierRegex.test(value);
}

function isImage(value) {
  return value == 'none' || value == 'inherit' || isUrl(value);
}

function isKeyword(propertyName) {
  return function(value) {
    return Keywords[propertyName].indexOf(value) > -1;
  };
}

function isNamedEntity(value) {
  return namedEntityRegex.test(value);
}

function isNumber(value) {
  return value.length > 0 && ('' + parseFloat(value)) === value;
}

function isRgbColor(value) {
  return rgbColorRegex.test(value);
}

function isPrefixed(value) {
  return prefixRegex.test(value);
}

function isPositiveNumber(value) {
  return isNumber(value) &&
    parseFloat(value) >= 0;
}

function isVariable(value) {
  return variableRegex.test(value);
}

function isTime(value) {
  return timeRegex.test(value);
}

function isUnit(compatibleCssUnitRegex, value) {
  return compatibleCssUnitRegex.test(value);
}

function isUrl(value) {
  return urlRegex.test(value);
}

function isZIndex(value) {
  return value == 'auto' ||
    isNumber(value) ||
    isKeyword('^')(value);
>>>>>>> upstream/master
}

function validator(compatibility) {
  var validUnits = Units.slice(0).filter(function (value) {
    return !(value in compatibility.units) || compatibility.units[value] === true;
  });

<<<<<<< HEAD
  var compatibleCssUnitRegexStr = '(\\-?\\.?\\d+\\.?\\d*(' + validUnits.join('|') + '|)|auto|inherit)';
  var compatibleCssUnitRegex = new RegExp('^' + compatibleCssUnitRegexStr + '$', 'i');
  var compatibleCssUnitAnyRegex = new RegExp('^(none|' + Keywords.width.join('|') + '|' + compatibleCssUnitRegexStr + '|' + cssVariableRegexStr + '|' + cssFunctionNoVendorRegexStr + '|' + cssFunctionVendorRegexStr + ')$', 'i');
  var colorOpacity = compatibility.colors.opacity;

  return {
    areSameFunction: areSameFunction,
    colorOpacity: colorOpacity,
    hasNoVendorPrefix: hasNoVendorPrefix,
    isValidBackgroundAttachment: isValidBackgroundAttachment,
    isValidBackgroundClip: isValidBackgroundClip,
    isValidBackgroundOrigin: isValidBackgroundOrigin,
    isValidBackgroundPosition: isValidBackgroundPosition,
    isValidBackgroundPositionPart: isValidBackgroundPositionPart,
    isValidBackgroundRepeat: isValidBackgroundRepeat,
    isValidBackgroundSizePart: isValidBackgroundSizePart,
    isValidColor: isValidColor,
    isValidColorValue: isValidColorValue,
    isValidFunction: isValidFunction,
    isValidFunctionWithoutVendorPrefix: isValidFunctionWithoutVendorPrefix,
    isValidGlobalValue: isValidGlobalValue,
    isValidHexColor: isValidHexColor,
    isValidHslaColor: isValidHslaColor,
    isValidImage: isValidImage,
    isValidKeywordValue: isValidKeywordValue,
    isValidListStylePosition: isValidListStylePosition,
    isValidListStyleType: isValidListStyleType,
    isValidNamedColor: isValidNamedColor,
    isValidRgbaColor: isValidRgbaColor,
    isValidStyle: isValidStyle,
    isValidTextShadow: isValidTextShadow.bind(null, compatibleCssUnitRegex),
    isValidUnit: isValidUnit.bind(null, compatibleCssUnitAnyRegex),
    isValidUnitWithoutFunction: isValidUnitWithoutFunction.bind(null, compatibleCssUnitRegex),
    isValidUrl: isValidUrl,
    isValidVariable: isValidVariable,
    isValidVendorPrefixedValue: isValidVendorPrefixedValue,
    isValidWidth: isValidWidth.bind(null, compatibleCssUnitRegex),
    isValidZIndex: isValidZIndex
=======
  var compatibleCssUnitRegex = new RegExp('^(\\-?\\.?\\d+\\.?\\d*(' + validUnits.join('|') + '|)|auto|inherit)$', 'i');

  return {
    colorOpacity: compatibility.colors.opacity,
    isAnimationDirectionKeyword: isKeyword('animation-direction'),
    isAnimationFillModeKeyword: isKeyword('animation-fill-mode'),
    isAnimationIterationCountKeyword: isKeyword('animation-iteration-count'),
    isAnimationNameKeyword: isKeyword('animation-name'),
    isAnimationPlayStateKeyword: isKeyword('animation-play-state'),
    isAnimationTimingFunction: isAnimationTimingFunction(),
    isBackgroundAttachmentKeyword: isKeyword('background-attachment'),
    isBackgroundClipKeyword: isKeyword('background-clip'),
    isBackgroundOriginKeyword: isKeyword('background-origin'),
    isBackgroundPositionKeyword: isKeyword('background-position'),
    isBackgroundRepeatKeyword: isKeyword('background-repeat'),
    isBackgroundSizeKeyword: isKeyword('background-size'),
    isColor: isColor,
    isColorFunction: isColorFunction,
    isDynamicUnit: isDynamicUnit,
    isFontKeyword: isKeyword('font'),
    isFontSizeKeyword: isKeyword('font-size'),
    isFontStretchKeyword: isKeyword('font-stretch'),
    isFontStyleKeyword: isKeyword('font-style'),
    isFontVariantKeyword: isKeyword('font-variant'),
    isFontWeightKeyword: isKeyword('font-weight'),
    isFunction: isFunction,
    isGlobal: isKeyword('^'),
    isHslColor: isHslColor,
    isIdentifier: isIdentifier,
    isImage: isImage,
    isKeyword: isKeyword,
    isLineHeightKeyword: isKeyword('line-height'),
    isListStylePositionKeyword: isKeyword('list-style-position'),
    isListStyleTypeKeyword: isKeyword('list-style-type'),
    isPrefixed: isPrefixed,
    isPositiveNumber: isPositiveNumber,
    isRgbColor: isRgbColor,
    isStyleKeyword: isKeyword('*-style'),
    isTime: isTime,
    isUnit: isUnit.bind(null, compatibleCssUnitRegex),
    isUrl: isUrl,
    isVariable: isVariable,
    isWidth: isKeyword('width'),
    isZIndex: isZIndex
>>>>>>> upstream/master
  };
}

module.exports = validator;
